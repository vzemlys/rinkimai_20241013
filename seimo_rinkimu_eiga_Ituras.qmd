---
title: "2024 metų Seimo rinkimų eigos analizė"
format: 
    html:
        embed-resources: true
        code-fold: true
        df-print: paged
        toc: true
        toc-location: left
        theme: cosmo
knitr: 
  opts_chunk: 
    echo: false
    message: false
    warning: false

---

## Apylinkių skaičius

Iš viso yra 1947 apylinkės

```{r}
library(dplyr)
library(lubridate)
library(ggplot2)

dt <- read.csv("data/20241013/daugmvrt.csv") %>% 
    mutate(timestamp = ymd_hms(timestamp)) %>% filter(timestamp>= ymd_hms("2024-10-13 21:00:00"))

ap <- dt %>%
    select(timestamp, apylinkes, lt_proc_rinkeju) %>%
    unique()

san <- readxl::read_xlsx("data/santrumpos.xlsx")

dt1 <- dt %>% left_join(san)

ggplot(aes(x = timestamp, y = apylinkes), data = ap) +
    geom_col() +
    theme_bw() +
    labs(x = "Laikas", y = "Apylinkės", title = "Apylinkių pristačiusių duomenis skaičius")
```
```{r}
ggplot(aes(x = timestamp, y = lt_proc_rinkeju), data = ap) +
    geom_col() +
    theme_bw() +
    labs(x = "Laikas", y = "Apylinkės", title = "Suskaičiuotų balsų procentas")
```


## Balsavimo rezultatai

### 7 partijos

```{r}
top7 <- c(3, 12,13,8,11,14,16)
cols <- RColorBrewer::brewer.pal(7, "Set1")

dt2 <- dt1 %>% filter(saraso_numeris %in% top7)

mt <- dt2 %>% select(saraso_numeris, santrumpa, spalva) %>% unique %>% arrange(saraso_numeris)

dt3 <- dt2 %>% mutate(santrumpa = factor(santrumpa, levels = mt$santrumpa))

ggplot(aes(x = timestamp, y = proc_nuo_dal_rinkeju, group = santrumpa, colour = santrumpa), data = dt3) +
    geom_point() +
    geom_line() +
    theme_bw() +
    scale_colour_manual(name = "Partija", values = mt$spalva) +
    labs(x = "Laikas", y = "Procentas nuo dalyvavusių rinkėjų", title = "Balsavimo rezultatų kitimas laike")
```


### Žemiau 5 procentų

```{r}


dtg <- dt1 %>% filter(proc_nuo_dal_rinkeju<5)
mtg <- dtg %>% select(saraso_numeris, santrumpa, spalva) %>% unique %>% arrange(saraso_numeris)

dtg1 <- dtg %>% mutate(santrumpa = factor(santrumpa, levels = mtg$santrumpa))

ggplot(aes(x = timestamp, y = proc_nuo_dal_rinkeju, group = santrumpa, colour = santrumpa), data = dtg1) +
    geom_point() +
    geom_line() +
    theme_bw() +
    scale_colour_manual(name = "Partija", values = mtg$spalva) +
    labs(x = "Laikas", y = "Procentas nuo dalyvavusių rinkėjų", title = "Balsavimo rezultatų kitimas laike")
```

### Įdomesni trendai

```{r}

ggplot(aes(x = timestamp, y = proc_nuo_dal_rinkeju, group = santrumpa, colour = santrumpa), data = dtg1 %>% filter(saraso_numeris %in% c(16,2))) +
    geom_point() +
    geom_line() +
    theme_bw() +
    scale_colour_manual(name = "Partija", values = mtg %>% filter(saraso_numeris %in% c(16,2)) %>% .$spalva) +
    labs(x = "Laikas", y = "Procentas nuo dalyvavusių rinkėjų", title = "Balsavimo rezultatų kitimas laike")
```